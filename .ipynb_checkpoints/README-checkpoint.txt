03/02/2021
The aim of this project is to create a lookup table of depth to surface area for all the reservoirs in Australia (or as many as possible). The steps have been done as follows:

1. Make your reservoirs shapefile: 01_Create_shapefile_of_Reservoirs.ipynb
Get the national hydropolys dataset from DEA. This is a shapefile that's publically available. in ArcMAP, select the polygon layer that has been labelled as 'Reservoirs' and save that out as it's own shapefile (you don't need the ones that aren't reservoirs). Then you want to only get the reservoirs that have names attached to them (01_Create_shapefile_of_Reservoirs.ipynb can do this bit for you). 

2. Make your gauges shapefile: 02_Match_gauges_to_Reservoirs.ipynb
You gotta get the Storage Level gauges from http://www.bom.gov.au/waterdata/. I used a webscraping script called dea-bom_storage.py, which is in the Scripts folder. This script was recycled from a project I did when I was working for DEA back in 2019. Kirill wrote it for me (he's a developer at DEA). I modified it a bit for this project, but basically it goes into the water data online website and returns the location of the 'Storage Level' gauges from all over Australia. To run this script and generate the shapefile, run '02_Match_gauges_to_Reservoirs.ipynb', it will do everything for you hopefully.

3. Spatial Join the gauges shapefile with the reservoirs shapefile: ArcMAP
Now you have a shapefile of gauges and you have a shapefile of reservoirs. Save them out and open them in ArcMAP and do a spatial join. The idea is to make a shapefile of reservoir polygons that have the gauge ID attached to each one. You won't get every single reservoir matched to every single gauge but you should get a couple hundred matched up, which is pretty good. 

4. Make a library of good quality gauge data: www.bom.gov.au/waterdata/ 
This is a little arduous but you just gotta do it. Not every single reservoir in Australia is going to have good gauge data, so you have to manually go and check every single reservoir (there's like 600 of them) your self and make a decision on the quality of the gauge data and decide if you're going to include it or not. I know it seems like a lot of work but just put some headphones on, it's not actually that bad. While doing this, you want to have a list of reservoirs printed out infront of you that you want data for. We used the ANCOLD list of reservoirs. Go to http://www.bom.gov.au/waterdata/ and manually search for 'Storage Level' gauges for each reservoir on the list and check if the hydrograph data is sufficient ('sufficient' for me meant data that went back to at least 2000 to get enough spread for the depth to surface area relationship). Download the good gauges as csv files and organise them neatly in a folder, which will be your library. The csv file names should contain the name of the reservoir and the gauge ID, for example 'Wivenhoe_143036A.csv'. Each time you get a good csv file of gauge data, cross it off the list. When you're done making the reservoirs shapefile with the gauge IDs attached, upload it back into the sandbox.

5. Make a shapefile of bounding boxes for the reservoirs: ArcMAP
Soon, you will want to get the satellite data for each reservoir so you can calculate surface area for each depth. When you have hundreds of reservoirs, you don't want to have to manually put in the extents of each reservoir so we'll make a shapefile of bounding boxes for each reservoir that can be used to call the satellite data for each reservoir. Make the bounding box shapefile in ArcMAP, it's pretty easy. I guess you can base the bounding boxes shapefile on the reservoirs shapefile you made in step 3, or you can filter the reservoirs to only get the ones that relate to the csv library of good gauge data you have then make a bounding box shapefile of just those ones (see 00_Library_reservoirs.ipynb). The bounding boxes obviously have to have the gauge IDs attached to them. When you are done making a bounding box shapefile in ArcMAP that has the gauge IDs, upload it back into the sandbox.

6. Generate the first iteration of the depth-to-surface area lookup tables: query_with_bounding_boxes.ipynb
Now you have all the shapefiles and csv files you need to make the depth to surface area relationship for a couple hundred gauges. Run 'query_with_bounding_boxes.ipynb' to load the satellite data, get the surface areas for each reservoir at each m of depth and generate the depth-to-surface area lookup table. The table it makes is a csv file so you can download it onto your computer and open it in excel. 

7. Generate the second iteration of the depth-to-surface area lookup tables: Clean_and_Interpolate.ipynb
You'll see with the first iteration that most of the reservoirs have a pretty good relationship, like the satellite images worked and you could see an image of the reservoir at each depth. However there are some images that are bad quality or missing, meaning the calculated surface area won't make sense. If you want to check individual reservoirs, like if you want to check the bad ones and see what the actual images looked like, you can enter the csv file into 'check_reservoirs.ipynb' and it will generate the images that the surface area was calculated off. You might see tire marks through the image thanks to one of the Landsat sensors breaking in 2011 or something, and that will cause you to get a way lower surface area than you should have got. You really need to get a good estimate of surface area for every single meter of depth for all of these reservoirs so now with the power of calculus we're going to fill the missing data. We'll delete the bad data and the zero values and fit a curve to the good data points that are left to represent how the surface area increases with depth for each uniquely shaped reservoir. This is hard because I don't really remember how to do calculus or polynomials/log functions or whatever. Anyway, the point is, you have to estimate the missing images using maths. I've started doing this in 'Clean_and_Interpolate.ipynb', so have a go at that. It's likely that each reservoir will have to be done individually. You will have to check the extrapolated depth-to-surface area graph for each reservoir and make sure the depth to surface area curve you're getting makes sense. You might have to alter the function you're applying each time. So yeah, brush up on your calculus and good luck!